<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pinet.rest.mapper.CartProductSpecMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.pinet.rest.entity.CartProductSpec">
        <result column="id" property="id"/>
        <result column="create_by" property="createBy"/>
        <result column="create_time" property="createTime"/>
        <result column="update_by" property="updateBy"/>
        <result column="update_time" property="updateTime"/>
        <result column="del_flag" property="delFlag"/>
        <result column="cart_id" property="cartId"/>
        <result column="shop_prod_spec_id" property="shopProdSpecId"/>
        <result column="shop_prod_spec_name" property="shopProdSpecName"/>
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        cps.id,
        cps.create_by,
        cps.create_time,
        cps.update_by,
        cps.update_time,
        cps.del_flag,
        cps.cart_id, cps.shop_prod_spec_id, cps.shop_prod_spec_name
    </sql>

    <insert id="insertBatchSomeColumn" useGeneratedKeys="true" keyProperty="id">
        insert into cart_product_spec
        (create_by,create_time,cart_id,shop_prod_spec_id,shop_prod_spec_name)
        values
        <foreach collection="list" item="item" separator="," index="index">
            (#{item.createBy},
            now(),
            #{item.cartId},
            #{item.shopProdSpecId},
            #{item.shopProdSpecName}
            )
        </foreach>
    </insert>


    <select id="selectByCartId" resultType="com.pinet.rest.entity.CartProductSpec">
        select cps.*, sps.price
        from cart_product_spec cps
                 left join shop_product_spec sps on cps.shop_prod_spec_id = sps.id
        where cps.cart_id = #{cartId}
          and cps.del_flag = 0
    </select>

    <select id="getComboByCartId" resultType="com.pinet.rest.entity.CartProductSpec">
        select cps.*, (sps.price * 0.01) as price
        from cart_product_spec cps
        left join kry_combo_group_detail sps on cps.shop_prod_spec_id = sps.id
        where cps.cart_id = #{cartId}
        and cps.del_flag = 0
    </select>


    <select id="selectByUserIdAndSpecId" resultType="com.pinet.rest.entity.CartProductSpec">
        select cps.*
        from qingshi.cart c
                 left join cart_product_spec cps on c.id = cps.cart_id
        where c.del_flag = 0 and c.customer_id = #{userId} and cps.shop_prod_spec_id = #{shopProdSpecId} limit 1
    </select>

    <select id="getByUserIdAndShopProdId" resultMap="BaseResultMap">
        select <include refid="Base_Column_List"/> from cart c
        left join cart_product_spec cps on c.id = cps.cart_id and cps.del_flag = 0
        where c.customer_id = #{userId} and c.shop_prod_id = #{shopProdId} and c.del_flag = 0
    </select>

</mapper>
