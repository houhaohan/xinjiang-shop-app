<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pinet.rest.mapper.OrderComboDishMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.pinet.rest.entity.OrderComboDish">
        <result column="id" property="id" />
        <result column="create_by" property="createBy" />
        <result column="create_time" property="createTime" />
        <result column="update_by" property="updateBy" />
        <result column="update_time" property="updateTime" />
        <result column="del_flag" property="delFlag" />
        <result column="order_id" property="orderId" />
        <result column="shop_prod_id" property="shopProdId" />
        <result column="single_prod_id" property="singleProdId" />
        <result column="dish_id" property="dishId" />
        <result column="prod_name" property="prodName" />
        <result column="unit_id" property="unitId" />
        <result column="unit" property="unit" />
        <result column="quantity" property="quantity" />
        <result column="image_url" property="imageUrl" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id,
        create_by,
        create_time,
        update_by,
        update_time,
        del_flag,
        order_id, shop_prod_id, single_prod_id, dish_id, prod_name, unit_id, unit, quantity, image_url
    </sql>



    <select id="getByOrderIdAndShopProdId" resultType="com.pinet.rest.entity.vo.OrderComboDishVo">
        select
            ocd.shop_prod_id,
            ocd.single_prod_id,
            ocd.dish_id as singleDishId,
            ocd.prod_name as singleProdName,
            sp.dish_code,
            ocd.unit_id,
            ocd.unit,
            ocd.image_url,
            ocds.add_price,
            ocds.shop_prod_spec_id,
            ocds.shop_prod_spec_name,
            kcgd.dish_sku_id
        from order_combo_dish ocd
        left join order_combo_dish_spec ocds on ocd.id = ocds.order_combo_dish_id and ocds.del_flag = 0
        left join shop_product sp on sp.id = ocd.single_prod_id
        left join kry_combo_group_detail kcgd on ocds.combo_group_detail_id = kcgd.id and kcgd.del_flag = 0
        where ocd.order_id = #{orderId}  and ocd.del_flag = 0
        order by ocd.id
    </select>
</mapper>
